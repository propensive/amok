                                                                                                  /*
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                                                                                                  ┃
┃                                                               ╭───╮                              ┃
┃                                                               │   │                              ┃
┃                                                               │   │                              ┃
┃                     ╭─────────╮ ╭───╮╌────╮╌────╮ ╭─────────╮ │   │ ╭───╮                        ┃
┃                     ╰─────╮   │ │   ╭─╮   ╭─╮   │ │   ╭─╮   │ │   │╌╯   │                        ┃
┃                     ╭─────╯   │ │   │ │   │ │   │ │   │ │   │ │        ╌╯                        ┃
┃                     │   ╭─╮   │ │   │ │   │ │   │ │   │ │   │ │   ╭─╮   │                        ┃
┃                     │   ╰─╯   │ │   │ │   │ │   │ │   ╰─╯   │ │   │ │   │                        ┃
┃                     ╰─────────╯ ╰───╯ ╰───╯ ╰───╯ ╰─────────╯ ╰───╯ ╰───╯                        ┃
┃                                                                                                  ┃
┃    Amok, prerelease version                                                                      ┃
┃    © Copyright 2023-25 Jon Pretty, Propensive OÜ.                                                ┃
┃                                                                                                  ┃
┃    The primary distribution site is:                                                             ┃
┃                                                                                                  ┃
┃        https://github.com/propensive/amok/                                                       ┃
┃                                                                                                  ┃
┃    Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file     ┃
┃    except in compliance with the License. You may obtain a copy of the License at                ┃
┃                                                                                                  ┃
┃        https://www.apache.org/licenses/LICENSE-2.0                                               ┃
┃                                                                                                  ┃
┃    Unless required by applicable law or agreed to in writing,  software distributed under the    ┃
┃    License is distributed on an "AS IS" BASIS,  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,    ┃
┃    either express or implied. See the License for the specific language governing permissions    ┃
┃    and limitations under the License.                                                            ┃
┃                                                                                                  ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                                                                                                  */
package amok

import soundness.{Node as _, *}

import html5.*

class SlidesFolio(base: Mountpoint, doc: AmokDoc, source: Path on Linux, sections: List[Html[Flow]])
extends Folio(base, t"slides", source):

  val userStyles =
    doc.styles.let: styles =>
      styles.set.map { variable => t"  --${variable.key}: ${variable.value};" }
      . join(t":root {\n", t"\n", t"\n}\n")
      + styles.stylesheet.or(t"")
    . or(t"").ascribe(media"text/css")

  def handle(using Http.Request, Stdio): Http.Response = subpath match
    case _ /: t"code.css"    => Http.Response(cp"/amok/code.css")
    case _ /: t"user.css"    => Http.Response(userStyles)
    case _ /: t"navigate.js" => Http.Response(cp"/amok/navigate.js")
    case _ =>
      Http.Response:
        HtmlDoc:
          Html
           (Head
             (html5.Link.Stylesheet(href = t"code.css"),
              html5.Link.Stylesheet(href = t"user.css"),
              html5.Script(src = t"navigate.js"),
              Title(doc.title)),
            Body(Div.visible(id = id"overlay"), Main(sections*)))
